const translations = {
	en: {
		appMessages: {
			welcome:
				"Welcome to Vocular! Connect and chat in over 35+ languages. Break down barriers, and build global connections",
			description:
				"This is a multi-lingual chat application, powered by AI",
		},
		placeholder: "Type a message...",
	},
	hi: {
		appMessages: {
			welcome:
				"Vocular में आपका स्वागत है! 35+ भाषाओं में जुड़ें और चैट करें। बाधाओं को तोड़ें और वैश्विक कनेक्शन बनाएं",
			description:
				"यह एक बहुभाषी चैट एप्लिकेशन है, जो AI द्वारा संचालित है",
		},
		placeholder: "एक संदेश लिखें...",
	},
	mr: {
		appMessages: {
			welcome:
				"Vocular मध्ये आपले स्वागत! ३५+ भाषांमध्ये जोडून चैट करा. अडथळे तोडा आणि जागतिक कनेक्शन तयार करा",
			description:
				"हे एक बहुभाषिक चैट अॅप्लिकेशन आहे, जे AI द्वारे चालवले जाते",
		},
		placeholder: "संदेश टाइप करा...",
	},
	gu: {
		appMessages: {
			welcome:
				"Vocular માં તમારું સ્વાગત છે! 35+ ભાષાઓમાં કનેક્ટ કરો અને ચેટ કરો. અવરોધો તોડો અને વૈશ્વિક કનેક્શન બનાવો",
			description:
				"આ એક બહુભાષી ચેટ એપ્લિકેશન છે, જે AI દ્વારા સંચાલિત છે",
		},
		placeholder: "સંદેશ ટાઇપ કરો...",
	},
	bn: {
		appMessages: {
			welcome:
				"Vocular-এ আপনাকে স্বাগতম! ৩৫+ ভাষায় সংযুক্ত হন এবং চ্যাট করুন। বাধা ভেঙে ফেলুন এবং বিশ্বব্যাপী সংযোগ তৈরি করুন",
			description:
				"এটি একটি বহুভাষিক চ্যাট অ্যাপ্লিকেশন, যা AI দ্বারা চালিত",
		},
		placeholder: "একটি বার্তা টাইপ করুন...",
	},
	ta: {
		appMessages: {
			welcome:
				"Vocular-க்கு வரவேற்கிறோம்! 35+ மொழிகளில் இணைந்து அரட்டையடியுங்கள். தடைகளை உடைத்து உலகளாவிய தொடர்புகளை உருவாக்குங்கள்",
			description:
				"இது ஒரு பன்மொழி அரட்டை பயன்பாடு, AI ஆல் இயக்கப்படுகிறது",
		},
		placeholder: "ஒரு செய்தி தட்டச்சு செய்யுங்கள்...",
	},
	te: {
		appMessages: {
			welcome:
				"Vocular కి స్వాగతం! 35+ భాషలలో కనెక్ట్ అవ్వండి మరియు చాట్ చేయండి. అవరోధాలను విచ్ఛిన్నం చేసి ప్రపంచవ్యాప్త కనెక్షన్లను నిర్మించండి",
			description:
				"ఇది AI ద్వారా శక్తివంతం చేయబడిన బహుభాషా చాట్ అప్లికేషన్",
		},
		placeholder: "ఒక సందేశాన్ని టైప్ చేయండి...",
	},
	kn: {
		appMessages: {
			welcome:
				"Vocular ಗೆ ಸ್ವಾಗತ! 35+ ಭಾಷೆಗಳಲ್ಲಿ ಸಂಪರ್ಕಿಸಿ ಮತ್ತು ಚಾಟ್ ಮಾಡಿ. ತಡೆಗಳನ್ನು ಮುರಿಯಿರಿ ಮತ್ತು ಜಾಗತಿಕ ಸಂಪರ್ಕಗಳನ್ನು ನಿರ್ಮಿಸಿ",
			description: "ಇದು AI ನಿಂದ ಚಾಲಿತವಾದ ಬಹುಭಾಷಾ ಚಾಟ್ ಅಪ್ಲಿಕೇಶನ್",
		},
		placeholder: "ಒಂದು ಸಂದೇಶವನ್ನು ಟೈಪ್ ಮಾಡಿ...",
	},
	ml: {
		appMessages: {
			welcome:
				"Vocular-ലേക്ക് സ്വാഗതം! 35+ ഭാഷകളിൽ കണക്ട് ചെയ്യുക, ചാറ്റ് ചെയ്യുക. തടസ്സങ്ങൾ തകർത്ത് ആഗോള കണക്ഷനുകൾ നിർമ്മിക്കുക",
			description:
				"ഇത് AI ഉപയോഗിച്ച് പ്രവർത്തിക്കുന്ന ഒരു ബഹുഭാഷാ ചാറ്റ് ആപ്ലിക്കേഷനാണ്",
		},
		placeholder: "ഒരു സന്ദേശം ടൈപ്പ് ചെയ്യുക...",
	},
	zh: {
		appMessages: {
			welcome:
				"欢迎来到 Vocular！用 35+ 种语言连接和聊天。打破障碍，建立全球连接",
			description: "这是一个多语言聊天应用程序，由 AI 驱动",
		},
		placeholder: "输入消息...",
	},
	es: {
		appMessages: {
			welcome:
				"¡Bienvenido a Vocular! Conéctate y chatea en más de 35 idiomas. Rompe barreras y construye conexiones globales",
			description:
				"Esta es una aplicación de chat multilingüe, impulsada por IA",
		},
		placeholder: "Escribe un mensaje...",
	},
	fr: {
		appMessages: {
			welcome:
				"Bienvenue sur Vocular ! Connectez-vous et discutez dans plus de 35 langues. Brisez les barrières et créez des connexions mondiales",
			description:
				"Ceci est une application de chat multilingue, alimentée par l'IA",
		},
		placeholder: "Tapez un message...",
	},
	de: {
		appMessages: {
			welcome:
				"Willkommen bei Vocular! Verbinden Sie sich und chatten Sie in über 35 Sprachen. Durchbrechen Sie Barrieren und schaffen Sie globale Verbindungen",
			description:
				"Dies ist eine mehrsprachige Chat-Anwendung, angetrieben von KI",
		},
		placeholder: "Nachricht eingeben...",
	},
	ja: {
		appMessages: {
			welcome:
				"Vocularへようこそ！35以上の言語で接続してチャットしましょう。障壁を破り、グローバルなつながりを築きましょう",
			description: "これはAIを活用した多言語チャットアプリケーションです",
		},
		placeholder: "メッセージを入力...",
	},
	it: {
		appMessages: {
			welcome:
				"Benvenuto su Vocular! Connettiti e chatta in oltre 35 lingue. Abbatti le barriere e costruisci connessioni globali",
			description:
				"Questa è un'applicazione di chat multilingue, alimentata dall'IA",
		},
		placeholder: "Digita un messaggio...",
	},
	pt: {
		appMessages: {
			welcome:
				"Bem-vindo ao Vocular! Conecte-se e converse em mais de 35 idiomas. Quebre barreiras e construa conexões globais",
			description:
				"Esta é uma aplicação de chat multilíngue, alimentada por IA",
		},
		placeholder: "Digite uma mensagem...",
	},
	ru: {
		appMessages: {
			welcome:
				"Добро пожаловать в Vocular! Подключайтесь и общайтесь на более чем 35 языках. Разрушайте барьеры и создавайте глобальные связи",
			description: "Это многоязычное чат-приложение, работающее на ИИ",
		},
		placeholder: "Введите сообщение...",
	},
	nl: {
		appMessages: {
			welcome:
				"Welkom bij Vocular! Verbind en chat in 35+ talen. Doorbreek barrières en bouw wereldwijde verbindingen",
			description:
				"Dit is een meertalige chat-applicatie, aangedreven door AI",
		},
		placeholder: "Typ een bericht...",
	},
	sv: {
		appMessages: {
			welcome:
				"Välkommen till Vocular! Anslut och chatta på över 35 språk. Bryt barriärer och skapa globala kontakter",
			description:
				"Detta är en flerspråkig chattapplikation, driven av AI",
		},
		placeholder: "Skriv ett meddelande...",
	},
	da: {
		appMessages: {
			welcome:
				"Velkommen til Vocular! Forbind og chat på mere end 35 sprog. Bryd barrierer og skab globale forbindelser",
			description:
				"Dette er en flersproget chatapplikation, drevet af AI",
		},
		placeholder: "Skriv en besked...",
	},
	no: {
		appMessages: {
			welcome:
				"Velkommen til Vocular! Koble til og chat på over 35 språk. Bryt ned barrierer og bygg globale forbindelser",
			description:
				"Dette er en flerspråklig chatteapplikasjon, drevet av AI",
		},
		placeholder: "Skriv en melding...",
	},
	fi: {
		appMessages: {
			welcome:
				"Tervetuloa Voculariin! Yhdistä ja keskustele yli 35 kielellä. Riko esteet ja rakenna globaaleja yhteyksiä",
			description: "Tämä on monikielinen chat-sovellus, jota AI käyttää",
		},
		placeholder: "Kirjoita viesti...",
	},
	pl: {
		appMessages: {
			welcome:
				"Witamy w Vocular! Łącz się i rozmawiaj w ponad 35 językach. Przełam bariery i buduj globalne połączenia",
			description:
				"To jest wielojęzyczna aplikacja czatu, zasilana przez AI",
		},
		placeholder: "Wpisz wiadomość...",
	},
	cs: {
		appMessages: {
			welcome:
				"Vítejte ve Vocular! Připojte se a chatujte ve více než 35 jazycích. Prolomte bariéry a budujte globální spojení",
			description: "Toto je vícejazyčná chatovací aplikace poháněná AI",
		},
		placeholder: "Napište zprávu...",
	},
	hu: {
		appMessages: {
			welcome:
				"Üdvözöljük a Vocularban! Csatlakozz és csevegj több mint 35 nyelven. Törd át a határokat és építs globális kapcsolatokat",
			description: "Ez egy többnyelvű chat alkalmazás, amelyet AI hajt",
		},
		placeholder: "Írj egy üzenetet...",
	},
	ro: {
		appMessages: {
			welcome:
				"Bun venit la Vocular! Conectează-te și discută în peste 35 de limbi. Dărâmă barierele și construiește conexiuni globale",
			description:
				"Aceasta este o aplicație de chat multilingvă, alimentată de AI",
		},
		placeholder: "Scrie un mesaj...",
	},
	bg: {
		appMessages: {
			welcome:
				"Добре дошли във Vocular! Свързвайте се и чатете на над 35 езика. Разрушавайте бариерите и изграждайте глобални връзки",
			description: "Това е многоезично чат приложение, задвижвано от AI",
		},
		placeholder: "Въведете съобщение...",
	},
	hr: {
		appMessages: {
			welcome:
				"Dobrodošli u Vocular! Povežite se i razgovarajte na više od 35 jezika. Srušite barijere i gradite globalne veze",
			description:
				"Ovo je višejezična aplikacija za chat, pokretana AI-em",
		},
		placeholder: "Upišite poruku...",
	},
	sk: {
		appMessages: {
			welcome:
				"Vitajte vo Vocular! Pripojte sa a chatujte vo viac ako 35 jazykoch. Prelomte bariéry a budujte globálne spojenia",
			description: "Toto je viacjazyčná chatovacia aplikácia poháňaná AI",
		},
		placeholder: "Napíšte správu...",
	},
	sl: {
		appMessages: {
			welcome:
				"Dobrodošli v Vocular! Povežite se in klepetajte v več kot 35 jezikih. Prebijte ovire in gradite globalne povezave",
			description:
				"To je večjezična aplikacija za klepet, ki jo poganja AI",
		},
		placeholder: "Vnesite sporočilo...",
	},
	et: {
		appMessages: {
			welcome:
				"Tere tulemast Voculari! Ühendu ja vestle rohkem kui 35 keeles. Murra barjääre ja loo globaalseid ühendusi",
			description: "See on mitmekeelne vestlusrakendus, mida juhib AI",
		},
		placeholder: "Sisestage sõnum...",
	},
	lv: {
		appMessages: {
			welcome:
				"Laipni lūdzam Vocular! Pievienojieties un tērzējiet vairāk nekā 35 valodās. Pārvariet barjeras un veidojiet globālus savienojumus",
			description: "Šī ir daudzvalodu tērzēšanas lietotne, ko darbina AI",
		},
		placeholder: "Ierakstiet ziņu...",
	},
	lt: {
		appMessages: {
			welcome:
				"Sveiki atvykę į Vocular! Prisijunkite ir kalbėkite daugiau nei 35 kalbomis. Sulaužykite barjerus ir kurkite pasaulinius ryšius",
			description:
				"Tai yra daugiakalbė pokalbių programa, varoma dirbtiniu intelektu",
		},
		placeholder: "Įrašykite žinutę...",
	},
	el: {
		appMessages: {
			welcome:
				"Καλώς ήρθατε στο Vocular! Συνδεθείτε και συνομιλήστε σε περισσότερες από 35 γλώσσες. Σπάστε τα εμπόδια και δημιουργήστε παγκόσμιες συνδέσεις",
			description:
				"Αυτή είναι μια πολυγλωσσική εφαρμογή συνομιλίας, που τροφοδοτείται από AI",
		},
		placeholder: "Πληκτρολογήστε ένα μήνυμα...",
	},
	mt: {
		appMessages: {
			welcome:
				"Merħba f'Vocular! Qabbad u ċċettja f'aktar minn 35 lingwa. Kissru l-barrieri u ibnu konnessjonijiet globali",
			description:
				"Din hija applikazzjoni taċ-chat multilingwi, immexxija minn AI",
		},
		placeholder: "Ittajpja messaġġ...",
	},
};

// Store all messages with their metadata for re-translation
let chatHistory = {
	chat1: [],
	chat2: [],
};

// Add your Gemini API key here
const GEMINI_API_KEY = "AIzaSyAFBgIMQ4HlIKXgLLWFhXNCoKkbeEZychY";
const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${GEMINI_API_KEY}`;

// Language code to language name mapping
const languageNames = {
	en: "English",
	hi: "Hindi",
	mr: "Marathi",
	gu: "Gujarati",
	bn: "Bengali",
	ta: "Tamil",
	te: "Telugu",
	kn: "Kannada",
	ml: "Malayalam",
	zh: "Chinese",
	ja: "Japanese",
	de: "German",
	fr: "French",
	es: "Spanish",
	it: "Italian",
	pt: "Portuguese",
	ru: "Russian",
	nl: "Dutch",
	sv: "Swedish",
	da: "Danish",
	no: "Norwegian",
	fi: "Finnish",
	pl: "Polish",
	cs: "Czech",
	hu: "Hungarian",
	ro: "Romanian",
	bg: "Bulgarian",
	hr: "Croatian",
	sk: "Slovak",
	sl: "Slovenian",
	et: "Estonian",
	lv: "Latvian",
	lt: "Lithuanian",
	el: "Greek",
	mt: "Maltese",
};

async function translateWithGemini(text, targetLang) {
	try {
		const prompt = `Translate the following text to ${
			languageNames[targetLang] || targetLang
		}: "${text}"

Return only the translation, no additional text or explanation.`;

		const response = await fetch(GEMINI_API_URL, {
			method: "POST",
			headers: {
				"Content-Type": "application/json",
			},
			body: JSON.stringify({
				contents: [
					{
						parts: [
							{
								text: prompt,
							},
						],
					},
				],
			}),
		});

		if (!response.ok) {
			throw new Error(`API request failed: ${response.status}`);
		}

		const data = await response.json();
		const translatedText = data.candidates[0].content.parts[0].text.trim();

		return translatedText;
	} catch (error) {
		console.error("Translation error:", error);
		// Fallback to English with language note
		return `${text} (translated to ${targetLang.toUpperCase()})`;
	}
}

function createMessageElement(messageData, displayLang) {
	const messageElement = document.createElement("div");
	messageElement.className = `message ${messageData.type}`;

	let content;
	if (messageData.type === "app") {
		// For app messages, use predefined translations
		const currentTranslations =
			translations[displayLang] || translations["en"];
		if (messageData.appMessageType === "welcome") {
			content = currentTranslations.appMessages.welcome;
		} else if (messageData.appMessageType === "description") {
			content = currentTranslations.appMessages.description;
		}
	} else {
		// For user messages, use stored translation or original
		content =
			messageData.translations[displayLang] || messageData.originalText;
	}

	messageElement.innerHTML = `
		<div class="message-bubble">
			${content}
			<div class="message-time">${messageData.timestamp}</div>
		</div>
	`;

	return messageElement;
}

async function rerenderChat(chatId, displayLang) {
	const chat = document.getElementById(chatId);
	const messages = chatHistory[chatId];

	// Clear current chat
	chat.innerHTML = "";

	// Re-render all messages
	for (const messageData of messages) {
		if (
			messageData.type !== "app" &&
			!messageData.translations[displayLang]
		) {
			// If we don't have translation for this language, translate it
			messageData.translations[displayLang] = await translateWithGemini(
				messageData.originalText,
				displayLang
			);
		}

		const messageElement = createMessageElement(messageData, displayLang);
		chat.appendChild(messageElement);
	}

	chat.scrollTop = chat.scrollHeight;
}

function updatePlaceholder(inputId, lang) {
	const input = document.getElementById(inputId);
	const currentTranslations = translations[lang] || translations["en"];
	if (input) {
		input.placeholder = currentTranslations.placeholder;
	}
}

async function sendMessage(chatId, inputId, targetLangSelector) {
	const input = document.getElementById(inputId);
	const message = input.value.trim();

	if (!message) return;

	const chat = document.getElementById(chatId);
	const currentLang = document.getElementById(
		chatId === "chat1" ? "lang1" : "lang2"
	).value;
	const targetLang = document.getElementById(targetLangSelector).value;
	const timestamp = new Date().toLocaleTimeString([], {
		hour: "2-digit",
		minute: "2-digit",
	});

	// Create message data
	const messageData = {
		type: "sent",
		originalText: message,
		originalLang: currentLang,
		timestamp: timestamp,
		translations: { [currentLang]: message },
	};

	// Add to chat history
	chatHistory[chatId].push(messageData);

	// Add message to current chat
	const messageElement = createMessageElement(messageData, currentLang);
	chat.appendChild(messageElement);
	chat.scrollTop = chat.scrollHeight;
	input.value = "";

	// Show loading indicator in target chat
	const otherChatId = chatId === "chat1" ? "chat2" : "chat1";
	const otherChat = document.getElementById(otherChatId);
	const loadingElement = document.createElement("div");
	loadingElement.className = "message received";
	loadingElement.id = "loading-message";
	loadingElement.innerHTML = `
		<div class="message-bubble">
			<span style="opacity: 0.6;">Translating...</span>
			<div class="message-time">${timestamp}</div>
		</div>
	`;
	otherChat.appendChild(loadingElement);
	otherChat.scrollTop = otherChat.scrollHeight;

	try {
		// Translate the message
		const translatedMessage = await translateWithGemini(
			message,
			targetLang
		);

		// Remove loading indicator
		const loadingMsg = document.getElementById("loading-message");
		if (loadingMsg) {
			loadingMsg.remove();
		}

		// Create translated message data
		const translatedMessageData = {
			type: "received",
			originalText: message,
			originalLang: currentLang,
			timestamp: timestamp,
			translations: {
				[currentLang]: message,
				[targetLang]: translatedMessage,
			},
		};

		// Add to other chat history
		chatHistory[otherChatId].push(translatedMessageData);

		// Add translated message to other chat
		const translatedElement = createMessageElement(
			translatedMessageData,
			targetLang
		);
		otherChat.appendChild(translatedElement);
		otherChat.scrollTop = otherChat.scrollHeight;
	} catch (error) {
		// Remove loading indicator and show error
		const loadingMsg = document.getElementById("loading-message");
		if (loadingMsg) {
			loadingMsg.remove();
		}

		// Fallback message
		const fallbackMessageData = {
			type: "received",
			originalText: message,
			originalLang: currentLang,
			timestamp: timestamp,
			translations: {
				[currentLang]: message,
				[targetLang]: `${message} (translated to ${targetLang.toUpperCase()})`,
			},
		};

		chatHistory[otherChatId].push(fallbackMessageData);
		const fallbackElement = createMessageElement(
			fallbackMessageData,
			targetLang
		);
		otherChat.appendChild(fallbackElement);
		otherChat.scrollTop = otherChat.scrollHeight;
	}
}

document.addEventListener("DOMContentLoaded", function () {
	// Initialize chat history with app messages
	chatHistory.chat1 = [
		{
			type: "app",
			appMessageType: "welcome",
			timestamp: "2:30 PM",
		},
		{
			type: "app",
			appMessageType: "description",
			timestamp: "2:32 PM",
		},
	];

	chatHistory.chat2 = [
		{
			type: "app",
			appMessageType: "welcome",
			timestamp: "2:30 PM",
		},
		{
			type: "app",
			appMessageType: "description",
			timestamp: "2:32 PM",
		},
	];

	document
		.getElementById("input1")
		.addEventListener("keypress", function (e) {
			if (e.key === "Enter") {
				sendMessage("chat1", "input1", "lang2");
			}
		});

	document
		.getElementById("input2")
		.addEventListener("keypress", function (e) {
			if (e.key === "Enter") {
				sendMessage("chat2", "input2", "lang1");
			}
		});
});

async function updateChat(chatId, langSelector) {
	const lang = langSelector.value;

	// Update placeholder text
	const inputId = chatId === "chat1" ? "input1" : "input2";
	updatePlaceholder(inputId, lang);

	// Re-render entire chat with new language
	await rerenderChat(chatId, lang);
}

document.getElementById("lang1").addEventListener("change", (e) => {
	updateChat("chat1", e.target);
});

document.getElementById("lang2").addEventListener("change", (e) => {
	updateChat("chat2", e.target);
});

document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
	anchor.addEventListener("click", function (e) {
		e.preventDefault();
		const target = document.querySelector(this.getAttribute("href"));
		if (target) {
			target.scrollIntoView({
				behavior: "smooth",
			});
		}
	});
});

// Initialize both chats with default language
document.addEventListener("DOMContentLoaded", function () {
	setTimeout(() => {
		updateChat("chat1", document.getElementById("lang1"));
		updateChat("chat2", document.getElementById("lang2"));
	}, 100);
});
